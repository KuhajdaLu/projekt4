\documentclass[11pt]{article}
\usepackage{graphicx}
\usepackage[czech]{babel}
\usepackage[utf8]{inputenc}
\usepackage{titling}
\usepackage{pdfpages}
\usepackage[nopar]{lipsum}
\usepackage{mathtools}
\usepackage{multirow}
\usepackage{caption}
\usepackage{float}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{amsmath}
\usepackage{amssymb}
\setlength{\parindent}{1cm}
\setlength{\hoffset}{-1.1cm} 
\setlength{\voffset}{-2cm}
\setlength{\textheight}{23.0cm} 
\setlength{\textwidth}{15cm}

\begin{document}
\title{Bakalářská práce}
\author{Lukáš Kuhajda}
\date{Akademický rok 2018/2019}
\begin{titlepage}
	\begin{center}
		\includegraphics[scale=0.5]{logo_zcu}\\
		\vspace{5cm}
		\begin{Large}
			\textbf{\thetitle}\\
		\end{Large}
		
		\vspace{3cm}
		\theauthor\\
		\vspace{5cm}
		\thedate
	\end{center}
\end{titlepage}
\newpage	
	
\tableofcontents
\newpage



\section{SLAM - Simultaneous Localization and Mapping}

\subsection{Úvod}
Simultaneous localization and mapping, v překladu simultánní lokalizace a mapování (SLAM) je problém, při kterém řešíme otázku, zda-li dokáže robot, umístěný do neznámého prostředí a s neznámou lokací, postupně utvářet mapu svého okolí a zároveň určovat místo, ve kterém se nachází. Řešení tohoto problému je nezbytně nutné pro tvorbu zcela autonomně se pohybujících robotů. Jedná se o aktuální téma vhledem k trendům moderní doby, kdy dochází k pozvolnému přechodu na samořiditelná auta. \\


\subsection{Historie}
Jako počátek, kdy byl daný problém poprvé zíněn, se bere konference Robotics and Automation Conference konaná v roce 1986. Pravděpodobnostní metody byly tehdy ještě velmi nerozvinuté, jak v robotice, tak i v umělé inteligenci, a došlo tak pouze k debatě na dané téma.\\
\indent K většímu posunu kupředu se dostalo o pár let později, kdy vyšla práce pojednávající o vztahu mezi orientačními body (landmarky) a zmenšení geometrické nepřesnosti. Důležitým prvkem zde bylo zjištění, že mezi odhady landmarků na mapě musí být velký stupeň korelace, přičemž korelace roste s dalšími pozorováními.\\
\indent Ve stejném období vznikaly základy vizuální navigace a navigace pracující se sonarem s použitím Kalmanova filtru. Práce byly v základu dosti podobné, ukazovaly, že odhady landmarků získané pohybem robota prostředím, jsou v korelaci s ostatními kvůli chybě v odhadu pozice robota a je třeba mít stav složený z pozice robota a landmarků. Vznikal tak však velký stavový vektor s náročností rostoucí v kvadrátu a tendence korelaci landmarků snižovat.\\
\indent Později došlo ke sjednocení problémů lokalizace a mapování a závěru, že snaha minimalizovat korelaci mezi landmarky byla chybná, naopak bylo v zájmu korelaci co nejvíce zvýšit. Struktura SLAMu, a celkově první použití tohoto akronymu, byla prezentována v roce 1995 na International Symposium of Robotics Research (ISRR). Poté v roce 199 se na ISRR odehrálo první zasedání pojednávající přímo o SLAM a došlo k představení práce dosahující stupeň konvergence mezi SLAMem na Kalmanově filtru a pravděpodobnostními metodami pro lokalizaci a mapování.


\subsection{Formulace a struktura SLAM} 
Jedná se o proces, při kterém robot vytváří mapu prostředí, v němž se pohybuje a na základě mapy určuje svoji pozici v prostoru. Pro určování trajektorie robota a rozložení landmarků není třeba znalosti jeho lokace, neboť odhad těchto parametrů probíhá součastně. 

\subsubsection{Legenda}
$k$ ... čas\\
$x_k$ ... stavovoý vektor popisující lokaci a orientaci robota\\ 
$u_k$ ... vektor aplikovaný v čase $k-1$ pro dostání robota v čase $k$ na pozici $x_k$\\
$m_i$ ... vektor popisující pozici i-tého landmarku, která je brána jako neměnící se v čase\\
$z_{ik}$ ... pozorování lokace i-tého landmarku z robota v čase $k$\\
$x_{0:k}$ ... historie umístění robota\\
$u_{0:k}$ ... historie vstupních dat pro pohyb robota\\
$z_{0:k}$ ... množina pozorování landmarků\\
$m$ ... množina landmarků\\

\subsubsection{Pravděpodobnostní SLAM}
V této formě je zapotřebí výpočet rozložení pravděpodobnosti 
$$P(x_k,m|Z_{0:k},U_{0:k},x_0)$$ 
pro každý časový okamžik ${k}$. Jedná se o srduženou posteriorní hustotu landmarků, stavu vozidla s ohledem na zaznamenané pozorování, řídící vstupy a zahrnuje čas ${k}$ s počátečním stavem vozidla. Pro výpočet je využit Bayesův teorém, je tedy potřeba, aby přechodový stavový model a model pozorování popisovaly vliv vstupního řízení a pozorování.\\
\indent Model pozorování popisuje pravděpodobnost zisku pozorování $z_k$, pokud známe polohu vozidla a landmarků. 
$$P(z_k|x_k,m)$$
\indent Model pohybu vozidla může být popsán jako stavový přechodový model. Předpokládáme přechodový stav jako Markovův proces, při kterém následující stav $x_k$ je závislý pouze na předchozím stavu $x_{k-1}$ a aplikovaném řízení $u_k$ a není tak závislý ani na mapě, ani na pozorování.
$$P(x_k|x_{k-1},u_k)$$
Máme tak implementaci ve dvoustupňové rekurzivní formě korekce předpovědí.\\
Aktualizace času:
$$P(x_k,m|Z_{0:k-1},U_{0:k},x_0)=\int P(x_k|x_{k-1},u_k)\times P(x_{k-1},m|Z_{0:k-1},U_{0:k-1},x_0)dx_{k-1}$$ 
Aktualizace měření:
$$P(x_k,m|Z_{0:k},U_{0:k},x_0)=\frac{P(z_k|x_k,m)P(x_k,m|Z_{0:k-1},U_{0:k},x_0)}{P(z_k|Z_{0:k-1},U_{0:k})}$$

\subsubsection{Struktura pravděpodobnostního SLAMu}
Model pozorování udává závislost polohy vozidla a pozování landmarků, sdružená posteriorní pravděpodobnost nemůže být klasicky rozdělena stylem 
$$P(x_k,m|z_k)\neq P(x_k|z_k)P(m|z_k),$$
neboť by to vedlo k chybným odhadům. Dalším zdrojem chyb je špatný odhad pozice robota, landmarky jsou ale silně korelované, takže chybný odhad landmarku vůči mapě nevede k chybné poloze dvou landmarků navzájem.\\
\indent Velmi důležitým poznatkem bylo zjištění, že korelace mezi landmarky monotónně vzrůstá s počtem jejich pozorování (potvrzeno pouze pro lineární Gaussovský případ), tudíž odhad pozice landmarků bude s narůstajícím počtem pozorování monotónně přesnější. Tento jev nastává díky, v podstatě, skoro nezávislému měření relativních pozic mezi landmarky, které jsou zcela nezávislé na natočení vozidla a úspěšné pozorovnání z tohoto bodu může nést další nezávislá měření relativních rozložení landmarků. \\
\indent Pohybem robota v prostoru získává pozorováním novou pozici známých landmarků vůči sobě a dle této informace aktualizuje svoji odhadovanou pozici a také pozici landmarků. Pokud ji nějaký landmark není pozorován, tak je jeho pozice aktualizována dle změny landmarků pozorovaných a pokud jsou zpozorovány landmarky nové, korelují se s zostatními, čímž se vytváří síť. Čím častěji jsou dva landmarky pozorovány při jednom měření, tím je síla korelace větší. Opětovným projížděním mapy tak získáváme přesnější a robustnější mapu.\\


\subsection{Řešení problému SLAM}
Při řešení je potřeba adekvátně obsáhnout jak složku modelace prostředí, tak i tvorbu pohybového modelu.
Máme řadu možností jak tento problém řešit, například princip Monte Carlo, kdy rozdělujeme hustoty pravděpodobnosti odhadu pozice robota. Další možností je Markovova lokalizace, s tímto přístupem jsme se setkali v pravděpodobnostní formě SLAM. Nejčastěji se setkáváme s reprezentací problému ve formě stavového modelu zatíženého šumem, což vede k použití rozšířeného Kalmanova filtru (v originále $extended$ $Kalman$ $filter\rightarrow EKF$). Jinou možností je ještě rozčlenit pohybový model vozidla na vzorky s obecnějším negausovským rozdělením pravděpodobnosti, v tomto případě mluvíme o použití Rao-Blackwellizedova partikulárního filtru. 

\subsubsection{EKF-SLAM}
Popis pohybu vozidla:
$$P(x_k|x_{k-1},u_k)\leftrightarrow x_k=f(x_{k-1},u_k)+w_k$$
$f(.)$ ... funkce modelující pohyb vozidla\\
$w_k$ ... chyby měření\\
$Q_k$ ... kovariance\\
\\
Model pozorování:
$$P(z_k|x_k,m)\leftrightarrow z_k=h(x_k,m)+v_k $$
$h(.)$ ... geometrické vlastnosti\\
$v_k$ ... chyby měření\\
$R_k$ ... kovariance\\
\\
Tyto dvě definice využijeme v EKF metodě k výpočtu průměru a kovariance sdruženého posteriorního rozložení\\
\indent průměr:
$$\begin{bmatrix}
\hat{x}_{k|k}\\\hat{m}_k
\end{bmatrix}=E
\begin{bmatrix}
x_k |Z_{0:k}\\m\indent
\end{bmatrix}$$ 
\indent kovariance:
$$P_{k|k}=\begin{bmatrix}
P_{xx} P_{xm}\\P^T_{xm} P_{mm}
\end{bmatrix}_{k|k}=E\begin{bmatrix}
\begin{pmatrix}
x_k-\hat{x}_k\\m-\hat{m}_k
\end{pmatrix} \begin{pmatrix}
x_k-\hat{x}_k\\m-\hat{m}_k
\end{pmatrix}^T |Z_{0:k}
\end{bmatrix}$$\\
Mezi hlavní problémy této metody se řadí konvergence, výpočetní složitost, sdružování dat a nelinerita. Prvním z nich, konvergence, se projevuje postupným přechodem determinantu kovarianční matice mapy a všech podkategorií dvojic landmarků k nule. Jednotlivé odchylky landmarků pak konvergují dle původních nepřesností z odhadu pozice robota a jeho pozorování.\\
\indent Výpočetní složitost je zde brána jako kvadraticky rostoucí s počtem zaznamenaných landmarků, neboť při každém zaznamenaném pozorování se aktualizují již uložené landmarky, tento problém již ale prošel vývojem a existují metody pracující v reálném čase s tisíci landmarky.\\
\indent Metoda EKF-SLAM je velmi náchylná na chybné spojení pozorování se známými landmarky. Jedná se zejména o problém s uzavřením smyčky, kdy dochází k opětovnému návratu na místo, ze kterého robot začínal nebo ve kterém se již nacházel.\\
\indent Nelinerita je posledním z významných problémů, kvůli níž můžeme dojít k větším nepřesnostem ve výsledku, neboť EKF-SLAM využívá lineárních modelů pro vyjádření nelineárního pohybu a modelu pozorování, konvergence a konzistence modelu je tedy jistá pouze v lineárním případě. 


\subsection{Rao-Blackweillizedův částicový filtr (RBPF)}
Forma SLAM založená na Rao-Blackellizedově filtru, jinak nazývaná také jako FastSLAM, je na bázi rekurzivního Monte Carlo modelu a dokáže reprezentovat nelineání stavový model. Je výpočetně nemožné aplikovat na stavový prostor s vysokým počtem dimenzí partikulární filtry, je však možné redukovat velikost vzorků. \\
Sdružený stav může být jako faktor komponentů vozidla a podmíněných komponentů mapy:
$$P(X_{0:k},m|Z_{0:k},U_{0:k},x_0)=P(m|X_{0:k},Z_{0:k})P(X_{0:k}|Z_{0:k},U_{0:k},x_0) $$ 
Rozdělení pravděpodobnosti zde není na jednotivých pozicích $x_k$, ale na celou trajektorii $X_{0:k}$ a tím se stávají jednotlivé landmarky na sobě nezávislými, mapa je tedy reprezentována jako soubor nezávislých gaussiánů, což znamená lineární složitost oproti kvadratické u formy EKF. Hlavními ukazateli FastSLAMu je mapa, jež je počítána analyticky a vážené vzorky, jimiž je reprezentována trajektorie pohybu. Rekurzivní odhad je proveden partikulárním filtrem pro stav pozice a EKF pro stav mapy.\\
\indent Zpracování každého landmarku probíhá zvlášť, pozice se aktualizuje stejným způsobem jako v EKF a landmarky, které nebyly zpozorovány, zůstávají na původní pozici a neaktualizují se. Vzájemnou neprovázaností landmarků však vzniká chyba v odhadu, která s časem roste.\\
\indent V čase $k-1$, je sdružený stav reprezentovaný jako 
$$\{w^{(i)}_{k-1},X^{(i)}_{0:k-1},P(m|X^{(i)}_{0:k-1},Z_{0:k-1})\}^V_i$$
V prvním kroce, pro každou částici vypočítáme návrh distribuce, jež je podmíněná svojí specifickou historií a z ní odebereme vzorek $x_k$, který je poté sdružen k historii částice $X^{(i)}_{0:k}$. Krokem dva, dle funkce důležitosti, stanovíme váhy vzorků. Třetím krokem je případné převzorkování, které se provádí různě často dle implementace. Krokem posledním je provézt EKF update, na každou, již zpozorovanou částici, která je při aktuálním pozorováním zaznamenána. 


\subsection{Výpočetní složitost}
Neobvyklá struktura problému, sdružený stav složený z pozice robota a landmarků, je využita v řadě metod pro redukci výpočetní složitosti, zde má model procesu vliv pouze na stav pozice robota a model pozorování na dvojici robot-landmark. Základním rozdělením metod redukujících výpočetní složitost, je rozlišování optimálních, konzervativních a nekonzistentních metod. První typ, optimální metody, jsou založené na redukci daného výpočtu, výsledkem jsou pak odhady a kovariance, stejně tak, jako je tomu v případě plnohodnotné formy SLAM, rozebírané v předchozích kapitolách. U metod konzervativních dochází k odhadům s vyšší neurčitostí nebo kovariancí, většinou ale, i přes větší nepřesnost, jsou implementovány v reálném použití. Poslední možností jsou nekonzistentní metody a jedná se o algorithmy, které mají nižsí neurčitost nebo kovarianci, než algoritmy optimální, ale pro řešení SLAM se v praxi nepoužívají.\\
\indent Prvním přístupem pro redukci výpočetní složitosti, je omezení požadovaného výpočtu rovnicí aktualizace pozorování. Výpočet časové aktualizace může být omezen metodami využívající rozšířený stav, výpočet stavu pozorování pak metodami oddělujícími rovnice dané aktualizace a obě tyto omezení vedou k redukci výpočtů, typicky jsou to optimální algoritmy. Další možností, je reformulace stavového prostoru do informační podoby, která umožnuje rozdělení výsledné matice s informacemi pro snížení výpočtů, což bývají algoritmy konzervativní. Obvykle je díky nim znatelně redukována výpočetní složitost a stále je zachována dostatečně dobrá odhadovací schopnost. Dalším přístupem je submapping, který rozděluje mapu na regiony, kdy následné aktualizace se konají pouze v dané oblasti a s určitou periodou poté i v rámci celé mapy. 

\subsubsection{Rozšířený stav}
Sdružený stavový vektor $x_k$ v čase $k$, se skládá z pozice robota a jím zaznamenaných landmarků, kdy model robota ovlivňuje pouze stav pozice, a to vlivem vstupního řízení, stav mapy se tím tedy nemění. 
$$x_k=\begin{bmatrix}
f_v(x_{vk-1},u_k)\\m
\end{bmatrix} $$
Pokud při volbě typu SLAM jako EKF, výpočet předpovědi kovariance má kubicky rostoucí složitost s počtem landmarků
$$P_{k|k-1}=\bigtriangledown f_xP_{k-1|k-1}\bigtriangledown f^T_x+\bigtriangledown f_uU_k\bigtriangledown f^T_u,$$
to se však dá předělat na formu s pouze lineární složitostí
$$P_{k|k-1}=\begin{bmatrix}
\bigtriangledown f_{vx}P_{vv}\bigtriangledown f^T_{vx}+\bigtriangledown f_{vu}U_k\bigtriangledown f^T_{vu}&&\bigtriangledown f_{vx}P_{vm}\\
P^T_{vm}\bigtriangledown f^T_{vx}&&P_{mm}
\end{bmatrix} $$
Přidání nového landmarku má podobný tvar, kdy je nový landmark inicializován jako funkce pozice robota a pozorování a rozšířený stav pak získáme z malého množství existujících stavů 
$$x^+_k=\begin{bmatrix}
x_{vk}\\m\\g(x_{vk},z_k)
\end{bmatrix},$$
kde $g(x_{vk},z_k)=m_{new}\rightarrow$ přidání nového landmarku \\
Rozšíření stavu můžeme aplikovat vždy, když je nový stav funkcí podmnožiny již existujících stavů
$$\begin{bmatrix}
x_1\\x_2\\f(x_2,q)
\end{bmatrix}, $$
$$
\begin{bmatrix}
P_{11}&&P_{13}&&P_{13}\bigtriangledown f^T_{x_2}\\
P^T_{12}&&P_{23}&&P_{23}\bigtriangledown f^T_{x_2}\\
\bigtriangledown f_{x_2}P^T_{11}&&\bigtriangledown f_{x_2}P_{32}&&\bigtriangledown f_{x_2}P_{32}\bigtriangledown f^T_{x_2}+\bigtriangledown f_qQ\bigtriangledown f^T_q
\end{bmatrix}
$$

\subsubsection{Oddělné aktualizace}
Jedná se o metody vytvářející optimální odhady. Při implementaci základní podoby aktualizace pozorování, se při každém novém měření aktualizuje jak stav vozidla, tak i mapy, což vede ke kvadratickému nárůstu složitosti s množstvím landmarků. V této metodě si však rozdělíme mapu na menší oblasti, které se aktualizují pouze při jejím průjezdu, zatímco aktualizace celé mapy probíhá s výrazně nižší frekvencí.\\
\indent Rozlišujeme dva způsoby možné implementace. První z nich pracuje na zmenšené oblasti, ale stále si drží globální referenční souřadnice, jedná se například o algoritmus CEKF (compressed EKF). Druhou možností je tvorba menších map s vlastním souřadnicovým rámcem neopouštějícím danou submapu, což jsou algorithmy CLSF (constrained local submap filter $\rightarrow$ omezený lokální submapový filtr). Pokračovat budeme v rozboru druhé možnosti, neboť je jednodušší a při provádění operací s velkou frekvencí opakování je méně ovlivněna linearizačními chybami, je stabilnější a zabraňuje příliš velkému nárůstu globální kovariance. \\
\indent Logaritmus submapy se skládá z dvou nezávislých odhadů, které si stále udržuje. Jde o vektory $x_G$ a $x_R$, kdy $x_G$ je mapa složená z globálně referencovaných landmarků a globálně referencované pozice dané submapy a $x_R$ je lokální submapa s lokálně referencovanou pozicí robota a lokálně referencovanými landmarky. Při získání pozorování se aktualizují pouze landmarky náležící aktuální submapě, ve které se robot nachází. Celkový globální odhad pak získáváme periodicky, zaevidováním submapy do mapy celé a použitím aktualizace omezení na společné vlatnosti obou map.

\subsubsection{Rozčlenění stavového prostoru}
V této metodě vyjadřujeme stavový odhad ($\hat{x}_k$) a matici kovariance ($P_k$) v informační formě pomocí matice informací $Y_k=P^{-1}_k$ a vektoru informací $\hat{y}_k=Y_k\hat{x}_k$. Je výhodné pro mapy s větším měřítkem, kdy spousta nediagonálních prvků bude velmi blízkých nule, což vede k možnosti nastavení těchto prvků na hodnotu nula. Může tím však vznikat malá ztráta optimality při vzniku map.\\
\indent Rozšíření stavu je rozčleňovací operace vedoucí k přesnému rozčlenění informační formy a má tak ekvivalentní informační formu. Předpokládáme, že podmnožina stavů $x_i$ obsahuje většinu stavů mapy a po rozčlenění dosahuje pouze konstantní složitosti v čase. Můžeme tedy získávat přesné řešení díky rozšiřování stavu novým odhadem pozice robota v každém kroce a zachovat všechny předchozí pozice. Nenulové nediagonální prvky jsou tak pouze ty, které jsou spojené napřímo s měřenými daty.\\
\indent Dále sem musíme zahrnout marginalizaci, jež je nezbytná pro odstranění předchozích stavů pozice. Máme možnost marginalizovat všechny předchozí stavy, což vede na zhuštěnou matici informací, a tedy stav, kterého dosáhnout nechceme. Správnou volbou ukotvení pozice můžeme marginalizovat velkou čast pozic, aniž bychom vyvolaly nadměrnou hustotu matice informací.

\subsubsection{Globální submapy}
Rozlišujeme dva základní typy submap a to globálně a lokálně referencované, přičemž oba mají společné, že submapa stanovuje místní souřadnicový rámec a landmarky z jejího okolí jsou odhadovány s ohledem na tento rámec.\\
\indent Lokální metoda získává odhady pomocí optimálního algoritmu, používajícího pouze lokální landmarky. Tato metoda, i přes výpočetní efektivitu, je při tvorbě struktury submap neoptimální. Globální metoda dokáže z kvadraticky rostoucí složitosti, udělat lineární, či dokonce v čase konstantní složitost. Je to možné díky údržbě a konzervativním odhadům celé mapy. Metoda stojí na odhadování globální pozice submapy v rámci mapy, nevede však ke zmírnění problémů s linearizací, způsobenou velkými nepřesnostmi v odhadu pozic.

\subsubsection{Submapy vztažné}
Základním rozdílem od metody globálních submap, je absence společného základního rámce. V této metodě se submapy zaznamenávají dle sousedství s ostatními a celou mapu pak můžeme získat souhrnem vektoru cesty. Submapy jsou, díky vyhýbání se globálním spojením, velmi zajímavé z hlediska výpočetní složitosti a problémům týkajících se nelinearity. Velkým kladem je například tvorba lokálně optimální mapy s výpočetní složitostí nezávislou na celkové velikosti mapy a dále, díky úpravám pouze na lokální úrovni, je velmi stabilní.

\subsection{Asociace dat}
Jedná se velmi důležitý problém, neboť, i když během procesu tvorby mapy dojde pouze k jedné chybné asociaci dat, může to vézt k destabilizaci odhadu mapy, často dokonce k pádu celého algoritmu

\subsubsection{Validace várky dat}
Z prvu se k problému přistupovalo způsobem, kdy se každé jednotlivé zachycení landmarku porovnávalo se všemi odhady nacházejícími se v blízkém okolí. Tento individuální přístup je neproveditelný, pokud je nejistá pozice robota, cožje tedy neproveditelné obzvlášť v málo zaplněných prostředích. 

\subsubsection{Popis vzhledu}
Jedním ze způsobů snímání okolí je vidění, kdy zaznamenáváme tvar, barvu, strukturu, a tím dokážeme rozlišovat různé balíčky dat, což využíváme pro přepověd dané asociace, nejčastěji pro problém s uzavřením smyčky. Pokrok této metody přišel, když se začala počítat metrika podobnosti přes sekvenci obrazů, místo původního jednoho. 

\subsubsection{Multihypoziční asociace dat}
Jedná se o metodu nepostradatelnou pro robustní sběr dat v přeplněním prostředí, kdy vytváříme oddělené odhady trasy jízdy pro každou asociační hypotézu. Tato funkce je však silně limitována dotupným výpočetním výkonem. Dále je metoda vyžívána při implementaci robustního SLAMu ve velkých prostředích, kdy je při uzavírání smyčky vytvořena hypotéza pro smyčku uzavřenou i pro stále neuzavřenou, a tím se bere v potaz, že je prostředí pouze podobné. 

\subsection{Reprezentace prostředí}
Původně se svět modeloval jen jako soubor landmarků majících svůj určitý tvar, později však, zejména ve venkovním, podvodním a podzemním použití, se ukázala tato metoda jako nevyhovující.

\subsubsection{Částečná pozorovatelnost a zpožděné mapování}
Základním typem pozorování je vidění pomocí kamery nebo nějaký typ dálkového senzoru. Kamera, pokud je na robotovi samostatně, zazamenává informace neobsahující přesnou vzdálenost objektu. Tento problém měření pomocí senzoru nemá, neboť meření vzdálenosti bývá velmi přesné, za to se pro tento typ vyskytuje problém se šířkou vysílaného paprsku a postraními žlábky. S tímto senzorem nedokážeme jedním pozorováním ani vytvořit přesně položený landmark, neboť tím získáváme negaussovské rozložení pro pozici landmarku a potřebujeme tak větší počet jeho zpozorování pro vytvoření odhadu.\\
\indent Obecná rozložení umožňují nezpožděné sledování landmarků, zpožděním inicializace však můžeme získat hned gaussovský odhad pozice landmarku, je při tom ale potřeba zaznamenávat pozici robota v každém okamžiku měření, což provedeme rozšířením stavu o vektor pozic. Nejedná se pouze o částečnou pozorovatelnost, ale shromažďování informací a zpoždění rozhodování zvyšuje robustnost procesu. 

\subsubsection{3D SLAM}
Jedná se v podstatě pouze o rozšíření 2D SLAMu, které má však výrazně větší výpočetní složitost a komplikovanější modelování. Rozlišujeme základní tři možnosti. První je klasický 2D SLAM s přidanou schopností vytvářet třetí dimenzi, což se užitečné, pokud se robot pohybuje po rovině. Druhý typ vytváří 3D obraz extrakcí diskrétních landmarků a sdruženého odhadu pozice vozidla a mapy. Využití je vhodné v robotech s jedním senzorem, který umožnuje pohyb se šesti stupni volnosti. Poslední možnost se od těch předchozích dost odlišuje. Sdružený stav se totiž skládá z předchozích pozic robota, na každé pozici se udělá 3D sken prostředí a odhad pozice se vyrovná korelací skenů.
 
\subsubsection{SLAM orientovaný pomocí trajektorie}
Základní formulací problému je odhadovaný stav, jako pozice robota a zaznamenané landmarky, jinou, novější možností, je odhadovat místo toho trajektorii vozidla. Mapa tak není součástí stavu, každá pozice robota má ale přidružený sken svého okolí, které se pak srovnají a vytvoří globální mapu. Z toho je hned patrný problém, neustálý růst stavového prostoru, který se nijak nepromazává. Využití metpdy se nachází například při tvorbě topologických map.

\subsubsection{Vložené pomocné informace}
Ke stavu můžeme připojit roziřující data, v tomto případě například teplotu, charakteristiku povrchu a mnoho dalších věcí, které pak napomáhají při tvorbě mapy. Tvorba takovéto struktury je ale poměrně komplikovaná. Pohybem robota prostředím se ukládají pomocná data do datové struktury tak, že každá buňka v této struktuře je přiřazena danému landmarku v mapě, při aktualizaci jaho pozice se tak přemisťují i přidružené informace. 

\subsubsection{Dynamická prostředí}
Ve světě se setkáváme převážně s dynamicky se vyvíjejícím prostředím, kdy nám do pozorování můžou zasahovat lidé, zvířata nebo třeba nábytek jako židle nebo zaparkovaná auta. Musí se tedy nějak určit, co s takovými objekty bude a jak je za pohyblivé určit. Máme možnost tyto objekty do mapy vůbec nepřidávat, nebo je mít označené za pohyblivé, nesmí se ale stát, že zaznamenáme pohyblivý objekt a uložíme ho jako statický. \\
\indent Klasická implementace SLAM umí odstranit landmark, i poměrně velké množství landmarků, bez většího vlivu na hodnotu konvergence. To je také využíváno pro úpravu mapy, kdy se odstraňují přebytečné landmarky, které se již na svém místě nenacházejí. 

\newpage

\section{Improved techniques for grid mapping with Rao-Blackwellized particle filters\\GMAPPING}

\subsection{Úvod}
Jako velice podstatný úkol mobilního robota, bereme schopnost tvorby mapy. Tu můžeme kvalitně vytvářet, pokud máme dobrý odhad pozice a pozici zase správně získávat, pokud máme dostatečně kvalitní mapu. Efektivním řešením je tedy RBPF, který můžeme ještě zlepšit. Jednou možností, je zahrnout přesnost měření do návrhového rozložení, tím získáme přesné vykreslení částic. Druhou možností, je volba vzorkovací techniky udržující rozumný počet částic. Udržujeme tak přesnou mapu a snižujeme riziko vyčerpání částice, což je problém vznikající při převzorkování.\\
\indent Návrhové rozložení získáváme vyhodnocováním pravděpodobnosti pozice robota z kombinace informací ze senzoru a odometrie. Poslední pozorování využíváme pro tvorbu nových částic, odhad stavu tedy provádíme na základě více informací, než jen z odometrie. 

\subsection{Mapování pomocí RBPF}
Základním úkolem je odhad posteriorní pravděpodobnosti a získat tím mapu a trajektorii pohybu, kdy odhad provádíme díky pozorování a informaci z odometrie. Nejprve dochází k odhadu mapy, kterou utváříme z pozorování, poté až trajektorii. Tu získáváme z částic, které měly v rozhodovací době největší pravděpodobnost a každá částice tedy reprezentuje část trajektorie.\\
\indent Pro výběr správné částice používáme částicový filtr, v tomto případě SIR (Sampling Importance Resampling), který postupně při mapování zpracovává data ze senzoru, poté odometrii a aktualizuje sadu vzorků reprezentující posteriorní pravděpodobnost o mapě a trajektorii. \\
\indent Celý proces začíná ziskem nových částic odběrem vzorků z předchozí generace návrhového rozložení. Dále nastavujeme částicím váženou důležitost, abychom neměli cílové rozložení rovno tomu navrhovanému. Poté dochází k převzorkování, kdy jsou částice přepisovány úměrně jejich váženým důležitostem a nakonec odhad mapy, kdy je pro každou částici, na základě trajektorie vzorku a historie pozorování, vypočítána mapa.


\subsection{RBPF s vylepšenými návrhy a adaptivním převzorkováním}
Pro zisk nové generace částic je třeba vykreslení vzorků z návrhového rozložení, kde platí úměra, čím lepší návrh, tím lepší výsledek. Kdybychom měli návrh rovný cílovému rozložení, měli bychom částice se stejnou váženou důležitostí a nebylo by třeba převzorkování. \\
\indent Typicky je návrhové rozložení odpovídající odometrickému pohybovému modelu, který však není optimální a to zejména pokud je senzor výrazně přesnější než odhad pozice. Využívá se také vyhlazování pravděpodobnostní funkce, což zabraňuje částicím v okolí významné oblasti, přílišnému poklesu vážených důležitostí. Následkem je ale zkreslení mapy. To se však dá vyřešit zahrnutím posledního pozorování do generování nových vzorků. Díky tomu se můžeme aměřit na vzorkování ve významné oblasti pro pravděpodobnost pozorování.\\
\indent Díky zlepšenému návrhu můžeme získávat pro každou částici zvlášť její parametry Gaussiánského návrhu a snižuje se také neurčitost výsledných hustot pravěpodobnosti. Porovnávač pozorování určuje režim výnamné oblasti pravděpodobnostní funkce pozorování. Také má většinou funkci maximalizace pravděpodobnosti pozorování, tvorby mapy a počáteční odhad pozice robota. Pokud je pravděpodobnostní funkce vícerežimová, například při uzavírání smyčky, porovnávač vrací pro každou částici nejbližší maximum, což může způsobit vynechání některých maxim v pavděpodobnostní funkci.\\
\indent Převzorkování je velice důležitým aspektem určujícím výkon částicového filtru, dochází k nahrazování vzorků s nízkou váhou, těmi s váhou vysokou. Je to nezbytný proces, neboť je potřeba konečného počtu částic pro aproximaci cílového rozložení. Může však odtranit dobré vzorky a ochudit tak částice, je proto důležité mít pro převzorkování vhodné rozhodovací kritérium a provádět ho ve správný čas. 
$$N_{eff}=\frac{1}{\varSigma_{i-1}^N(w^{(i)})^2}$$ 
$w^{(i)}$ ... normalizovaná váha částice $i$ \\
$N_{eff}$ - vzorky z cílového rozložení $\rightarrow$ stejné váhové důležitosti (zhoršující se aproximace cílového rozložení $\rightarrow$ větší odchylka vážených důležitostí)\\
Základní nastavení převzorkování je následující:
$$N_{eff} < N/2$$
$N$ ... počet částic\\
Dochází tak k výrazné redukci možnosti nahrazení dobrých částic a počtu převzorkování, které se vykonává pouze pokud je potřeba.\\
\indent Algoritmus probíhá následovně. Zisk odhadu pozice, který je reprezentovaný danou částicí. Dostaneme ho z předchozí pozice částice a odometrického měření od poslední aktualizace. Na základě mapy je provedeno porovnání pozorování z místa úvodního odhadu pozice, kdy se vyhledává pouze v okolí tohoto bodu. V případě selhání se pozice a váhy počítají dle pohybového modelu a následující dva kroky jsou přeskočeny. Prvním z nich vybrání sady vzorků v okolí dané pozice, vypočítání průměrů a kovarianční matice návrhu bodovým hodnocením cílového rozložení v pozici vzorku. Druhým, potenciálně přeskočeným krokem, je zakreslení nové pozice částice z Gaussovské aproximace podle zlepšeného návrhového rozložení. Dále, a to již vždy, dojde k aktualizaci vážených důležitostí a podle zakreslené pozice a pozorování je aktualizována i mapa částice. 
 
\subsection{Složitost}
Výpočet návrhového rozložení ... $O(N)$\\
Aktualizace grid mapy ... $O(N)$\\
Výpočet vah ... $O(N)$\\
Testováí potřeby převzorkování ... $O(N)$\\
Převzorkování ... $O(N*M)$\\
$M$ ... velikost grid mapy\\



\newpage

\section{Real-Time Loop Closure in 2D LIDAR SLAM \\ CARTOGRAPHER}

\subsection{Úvod}
Systém Cartographer je vyvíjen společností Google. Je vhodný pro tvorbu rozsáhlých map a zisk optimalizovaných výsledků v reálném čase. Při porovnávání snímků typem scan-to-scan dochází rychlému hromadění globálních chyb, v případě porovnávání stylem scan-to-map dochází, při správném odhadu pozice a kvalitnímu snímku z LIDARu, k velké redukci chyb, což vede k větší efektivnosti a robustnosti algoritmu. Dále se využívá také porovnávání přesnosti pixelů. Jde o metodu redukující hromadění lokálních chyb a je vhodná při řešení problému uzavírání smyčky. \\

\subsection{Přehled}
Cartographer vytváří v reálném čase 2D mřížkovou mapu s rozlišením na 5 cm. Submapy se vkládají na odhadované místo a daná submapa se porovnává vůči poslední zaznamenané, dochází tedy k hromadění globální chyby z odhadu pozice. Systém neobsahuje žádný částicový filtr. Je to z důvodu snížení hardwarových nároků na běh algoritmu.\\
\indent Submap se již po pořízení dále nijak nepřepisuje a je zařazena mezi ostatní k porovnávání na uzavření smyčky. Pokud dojde k blízkému odhadu pozice a zároveň dostatečné shodě snímků, přidá se omezení uzavření smyčky do optimalizačního problému, tím je odhad pozice. Odhad se aktualizuje po několika vteřinách a uzavření smyčka je tedy okamžitě viditelné. 

\subsection{Lokální 2D SLAM}
Rozlišujeme dva možné přístupy, lokální a globální, v obou případech se jedná o optimalizaci pozice, přičemž pozice se zkládá z hodnoty na ose $x$, z hodnoty na ose $y$ a z natočení robota. V systému je také obsažená jednotka IMU (inertial measurment unit), která slouží k odhadu směru gravitace, což má využití při pohybu na nerovné ploše.\\
\indent Skeny prostředí se iterativně zarovnávají se snímky již obsaženými v submapě. Submapa je tedy v postatě zachycení kousku světa, který je složený z pár skenů. Lokální chyba, vznikající při její tvorbě, je poté odstraněna v globálním přístupu. Pro každý bod mřížky zadefinujeme odpovídající pixel skládající se ze všech pixelů nejblíže danému bodu.\\
\indent Při přidání skenu do pravděpodobnostní mřížky, počítáme množinu zasažených bodů mřížky a bodů minutých. Při zásahu vložíme nejbližší bod mřížky do množiny zásahů. Při minutí vložíme bod mřížky sdružený se všemi pixely, které jsou protínány jedním paprskem mezi počátkem skenování a každým snímacím bodem. Nepřidáváme sem body již přidané do množiny zásahů. Doposud nepozorované body mřížky mají přiřazenou pravděpodobnost minutí či zásahu, podle toho, jestli se v jedné z těchto množin vyskytují. Již pozorovaným bodům pak aktualizujeme pravděpodobnosti minutí a zásahu.\\
\indent Před vložením skenu do submapy se ještě využívá Ceres scan matching, který optimalizuje pozici skenu vůči submapě. Jedná se o maximalizaci pravděpodobnosti výskytu v dané oblasti.  

$$argmin_\xi\Sigma^K_{k=1}(1-M(T_{\xi}h_k))$$
$H$ ... informace o bodech skenu\\
$M$ ... pravděpodobnostní mřížka\\
$\xi$ ... pozice snímání skenu\\
$T_{\xi}$ ... pozice skenu vůči submapě - transormace (body skenu do submapy)\\

\subsection{Uzavírání smyčky}
Daný systém pracuje v oblasti submap s porovnáváním scan-to-scan, hromadí se v něm tedy lokální chyby, ale pár snímků za sebou má vůči sobě chybu minimální. Relativní pozice skenů se ukládají a v případě, že se submapa nezmění, všechny další páry ze skenů a submapy se předkládají k porovnávání pro uzavření smyčky. To vše běží na pozadí a pokud je nalezena shoda, dojde k uložení relativní pozice mezi optimalizační problémy.\\
\indent Optimalizační problém je problém nelineárních nejmenších čtverců. Díky tomu můžeme jednoduše přidávat zbytky pro zohledňování dalších dat. Jednou za pár sekund je, pro optimalizaci pozice skenu vůči daným omezením, spuštěn Ceres scan matcher. Omezeními jsou myšlena relativní pozice $\xi_{ij}$ a kovarianční matice $\Sigma_{ij}$.

$$argmin_{\Xi^m,\Xi^s}0.5\Sigma_{ij}\rho(E^2(\xi_i^m,\xi_j^s,\Sigma_{ij},\xi_{ij}))$$
$\rho$ ... ztrátová funkce (např. Hubertova ztráta - snížení vlivu odlehlých hodnot, ty přiávají nesprávná omezení do optimalizačního problému)\\

\indent Při uzavírání smyčky se vyžívá také branch-and-bound scan matching, což se dá přeložit jako porovnávání větví a mezí. Zde se zaměřujeme na přesnou shodu pixelů. Podmnožiny možností jsou zde popsány jako uzly stromu kdy kořenový uzel obsahuje všechna možná ($W$). Potomci uzlu dohromady utváří stejný soubor možností, jako samotný rodičovský uzel. Listy jsou brány jako singlety, odpovídají jedinému proveditelnému řešení. Tento přístup nám dává stejné řešení jako ten předchozí, dokud je hodnota $score(c)$ vnitřních uzlů horní mezní skóre jeho prvků, neexistuje tedy žádné řešení, než to doposud známé.

$$\xi^*=argmax_{(\xi\epsilon W)}\Sigma_{k=1}^KM_{nearest}(T_{\xi}h_k) $$
$W$ ... vyhledávací okno\\
$M_{nearest}$ ... rozšíření pravděpodobnostní mřížky $M$ na všechny $R^2$ zaokrouhlením argumentů do nejbližšího bodu mřížky - rozšířená hodnota bodu mřížky ukazuje na odpovídající pixel\\

\indent Výběr uzlů probíhá prohledáváním do hloubky, Efektivnost algoritmu hodně závisí na podobě stromu, zda-li má pro výpočet dobrou horní mez a dobré aktuální řešení. Důležitým termínem je zde prahová hodnota skóre. Jedná se o hodnotu, pod níž nemáme zájem jít a řešení je pro nás tedy nevyhovující. Díky tomu nepřidáváme špatné shody jako omezení pro uzavírání smyčky. Pro rychlost algoritmu je důležité rozhodování o průchodu stromem. Pro každého potomka se vypočítá horní hranice skóre a vybíráme toho nejslibnějšího, což je uzel s největším mezním počtem.\\
\indent Každý z uzlů je popsán pomocí tuple integerů: 
$$c=(c_x,c_y,c_\Theta,c_h)\epsilon Z^4$$
$c_h$ ... výška uzlu - $c_h=0 \rightarrow$ uzel je list\\
\indent Horní meze jsou počítány na vnitřních uzlech, máme zde zájem o výpočetní úsilí a kvalitu spojení. 
$$score(c)=\Sigma_{k=1}^Kmax_{(j\epsilon \bar{W})}M_{nearest}(T_{\xi_j}h_k)$$

\newpage

\section{A Flexible and Scalable SLAM System with Full 3D Motion Estimation \\ Hector SLAM}

\subsection{Úvod}
Hlavním znakem systému Hector SLAM, je jeho rychlost a nízké výpočetní nároky oproti předchozím dvěma typům, které jsou v této práci rozebírány. Je tedy vhodný pro implementaci v menších autonomních systémech, pro rychlý pohyb terénem a nehodí se pro uzavírání velkých smyček.\\
\indent Vnitřní složení je z hlavních tří částí, a to 2D SLAM, běžící jako soft real time, 3D navigace, která je hard real time a jednotka IMU, která se nachází i v systému Cartographer. Hector SLAM je braný jako frontend SLAM, což znamená, že dochází k odhadu robota v reálném čase. Backend SLAM optimalizuje poziční graf vzhledem k omezením mezi pozicemi.

\subsection{Přehled}
Daný systém se musí převézt z 3DOF pomocí naklonění a rotace na 6DOF, kdy navigační filtr spojí měření z inerciální jednotky (IMU) a dalších senzorů, tím získáváme 3D řešení a díky 2D SLAMu máme informaci o poloze v prostoru. Oba odhady se aktualizují nezávisle na sobě a jsou propojeny jen velmi málo.\\
\indent Kvůli znatelnému posunu odhadů integrované pozice a rychlosti, který je způsoben šumem v senzorech, zahrnujeme do systému další informace, jako je například porovnávání snímků, snímání magnetického pole, senzor barometrického tlaku a nebo měření rychlosti kol.

pohyb tuhého tělesa:
$$\dot{\Omega}=E_\Omega.\omega$$
$$\dot{p}=v$$
$$\dot{v}=R_\Omega.a+g$$
$x=(\Omega^T p^T v^T)^T$ ... reprezentace 3D stavu\\
$\Omega=(\phi,\theta,\psi)^T$ ... otáčení, stoupání, natočení\\
$p,v$ ... pozice, rychlost platformy v navigačním rámci\\
$u=(\omega^T a^T)^T$ ... vstupní vektor pro inerciální měření\\
$\omega=(\omega_x,\omega_y,\omega_z)^T$ ... úhlová rychlost\\
$a=(a_x,a_y,a_z)^T$ ... zrychlení\\
$R_\Omega$ ... matice směrových cosinů\\
$E_\Omega$ ... mapování natočení těla na deriváty Eulerova úhlu\\
$g$ ... vektor gravitace\\

\subsection{2D SLAM}
Jako reprezentace prostředí je zde vybrána osvědčená metoda mřížkových map. Odhadovaná pozice robota slouží pro transformaci skenu na lokální stabilizovaný souřadnicový rámec. Odhadovanou orientací a přidruženými hodnotami je ze skenu vytvořen oblak bodů, který si pro odstranění odlehlých bodů předzpracováváme. Filtrace probíhá pouze na základě souřadnic koncového bodu, kdy jsou pro porovnávání skenu použity pouze koncové body v rámci skenovací roviny.\\
\indent Jak již bylo poznamenáno, je zde použita struktura mřížkových map, to vede k omezení přesnosti a neumožnění přímého výpočtu interpolovaných hodnot a derivátů. Pro oba odhady se tedy využívá interpolační schéma, díky kterému tu možnost máme. Jakoukoliv souřadnici, kterou potřebujeme nahradit, aproximujeme pomocí čtyř nejbližších integerových souřadnic. \\
\indent Laserové skenery jsou již velice přesná zařízení, jejich měření zatěžuje minimální šum a snímky se dají vytvářet s vysokou frekvencí. Měření pomocí laseru je tedy mnohem přesnější než to odometrické, což je jeden z důvodu, proč je odometrie v tomto systému zcela vynechána. Při zarovnávání snímků s již známou mapou, nepotřebujeme hledat žádná spojení mezi koncovými body, ale porovnáváme s předchozími skeny.  

Hledání transformace s nejlepším sladěním skenu s mapou:
$$\xi^*=argmin_\xi\Sigma_{i=1}^n[1-M(S_i(\xi))]^2$$
$M(P_m)$ ... hodnota obsazenosti\\
$S_i(\xi)$ ... souřadnice koncového bodu $s_i=(s_{i,x},s_{i,y})^T$\\
$\xi$ ... souřadnice robota\\
$M(S_i(\xi))$ ... hodnota mapy v souřadnicích $S_i(\xi)$\\
odhad $\Delta\xi$ ... optimalizace chyby měření podle: 
$$\Sigma_{i=1}^n[1-M(S_i(\xi+\Delta\xi))]^2\rightarrow 0$$

\indent Při tvorbě mapy dochází často k nalezení pouze lokálního minima, reprezentací mapy pomocí více rozlišení se tak toto riziko znatelně redukuje. Utváří se mřížkové mapy, kdy každá další má poloviční rozlišení, než ta předchozí. Máme tak uloženo více map, které se součastně aktualizují podle odhadu aktuální pozice, který je generovaný zarovnávacím procesem. Díky tomuto přístupu jsou mapy konzistentní a nepotřebují převzorkovávání. Zarovnávání skenů probíhá pouze na mapě s nejvyšším rozlišením a tento odhad je pak, jak je uvedeno, použit pro ostatní mapy. Mapy s nízkým rozlišením máme tedy v podstatě dostupné okamžitě, a můžeme je hned použít pro odhad trasy. 

\subsection{Odhad 3D stavu}
Pro odhad úplného 6D stavu (3D stav + informace o naklonění z gyroskopů a informace z akcelerometrů) slouží navigační filtr běžící v reálném čase, který je asynchronně aktualizován při příchodu odhadované pozice z porovnávače nebo jiných informací ze senzorů. Filtr je implementován ve formě EKF, jedná se tedy o nelineární filtr a jako jeho známé vstupy se berou inerciální měření. Rychlost a pozici aktualizujeme integrací zrychlení. Abychom se ale zabránilo nezávislému růstu odhadu stavu při nepřítomnosti měření, dochází k aktualizace pseudo-nulové rychlosti, které se spouští při dosažení odchylky určité prahové hodnoty a zajišťuje stabilitu systému.\\
\indent Při integraci systému máme tedy základní dva celky, 2D SLAM a 3D stavový odhad, které spolu musejí komunikovat v obou směrech. Jejich fungování neni nijak synchronizováno, odhad stavu běží typicky s vyšší frekvencí. Odhadovaná pozice z EKF je brána jako počáteční odhad pro optimalizaci porovnávání. Opačným směrem je použit pro spojení pozice ze SLAM s celkovým odhadovaným stavem kovarianční průsečík (CI - covariance interseption).























\end{document}